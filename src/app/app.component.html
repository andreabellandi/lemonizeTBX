<div class="layout-header">TBX to Lemon interactive tool</div>

<div class="progressBar" *ngIf="0 < progress && progress < 100">
  <p-progressBar [value]="progress"></p-progressBar>
</div>

<p-blockUI [blocked]="loading">
  <p-progressSpinner></p-progressSpinner>
</p-blockUI>

<p-toast></p-toast>

<div class="layout-body">
  <p-tabView (onChange)="onChangeTab($event)">
  <p-tabPanel header="Data Ingestion">

    <div class="flex flex-wrap gap-3">
        <div class="flex align-items-center">
          <strong>Conversion type:</strong>
          &nbsp;
          <p-radioButton [disabled]="true" name="conversionType" value="interactive" [(ngModel)]="conversionType" inputId="interactive"></p-radioButton>
          <label for="interactive" class="ml-2" (mouseenter)="interactiveTip.show($event)" (mouseout)="interactiveTip.hide()"> Interactive</label>
          &nbsp;
          <p-radioButton name="conversionType" value="automatic" [(ngModel)]="conversionType" inputId="automatic"></p-radioButton>
          <label for="conversionType" class="ml-2" (mouseenter)="automaticTip.show($event)" (mouseout)="automaticTip.hide()"> Automatic</label>
        </div>

      </div>

      <p-overlayPanel #interactiveTip>
        The conversion process is made of a series of steps, among which:
        <ul>
          <li>concept and language filtering</li>
          <li>mapping of TBX concepts to ontological ones</li>
          <li>term and relationship mapping to the lemon model</li>
        </ul>
      </p-overlayPanel>

      <p-overlayPanel #automaticTip>
        Each concept is mapped to a SKO concept, and each term is mapped to a lexical entry.
      </p-overlayPanel>

      <p-fileUpload align="right" mode="basic" name="demo[]" url="https://www.primefaces.org/cdn/api/upload.php" (onUpload)="onUpload($event)" [auto]="true" chooseLabel="Import"></p-fileUpload>

      <div class="spacer"></div>

      <app-tbx-summary [summary]="resource?.summary"></app-tbx-summary>

    </p-tabPanel>

  <p-tabPanel header="Data Filtering" [disabled]="!resource">
    <div *ngIf="resource">
      <strong>Languages: </strong>&nbsp;
      <p-multiSelect (onChange)="onChangeLanguage($event)" [filter]="false" [options]="resource.summary.languages | keys" [(ngModel)]="filter.languages"></p-multiSelect>

      &nbsp;
      &nbsp;

      <strong>Subject Field: </strong>&nbsp;
      <p-multiSelect (onChange)="onChangeSubjectField($event)" [filter]="false" [options]="resource.summary.subjectFields? resource.summary.subjectFields : []" [(ngModel)]="filter.subjectFields"></p-multiSelect>

      &nbsp;
      &nbsp;

      <strong>Concept date: </strong>&nbsp;
      <p-multiSelect (onChange)="onChangeDates($event)" [filter]="false" [options]="resource.summary.dates? resource.summary.dates : []" [(ngModel)]="filter.dates"></p-multiSelect>

      <p-divider></p-divider>

      <app-filter-view [resource]="filteredResource"></app-filter-view>

    </div>
  </p-tabPanel>

  <p-tabPanel header="Concept Mapping" [disabled]="!resource">

    <div>
      <p-checkbox label="No concepts" [binary]="true" [(ngModel)]="filter.noConcepts"></p-checkbox>&nbsp;
    </div>

    <div *ngIf="!filter.noConcepts">
      <span>
        <label for="mapConceptTo">Map concept to: </label>&nbsp;
        <p-dropdown name="mapConceptTo" [options]="[{name: 'URL', code: 'url'}, {name: 'Lexical Concept', code: 'lexical'}, {name: 'Skos Concept', code: 'skos'},{name: 'OWL Concept', code: 'owl'}]" [(ngModel)]="conceptMapping" optionValue="code" optionLabel="name"></p-dropdown>
      </span>

      <div>
        <label for="defaultNamespace">Default namespace: </label>&nbsp;
        <input name="defaultNamespace" type="text" pInputText [(ngModel)]="defaultNamespace" />

      </div>
      <p-divider></p-divider>

      <p-table *ngIf="filteredResource" [value]="filteredResource!.concepts | keyvalue" [tableStyle]="{ 'min-width': '50rem' }">
        <ng-template pTemplate="header">
            <tr>
                <th>Concept</th>
                <th>Relationship</th>
                <th>URL</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-item>
            <tr>
                <td>{{ item.value.id }}</td>
                <td>
                  <p-radioButton name="relationship{{ item.value.id }}" value="See also" [(ngModel)]="conversionType" inputId="seeAlso{{ item.value.id }}"></p-radioButton>
                  <label for="interactive" class="ml-2"> See also</label>
                  &nbsp;
                  <p-radioButton name="relationship{{ item.value.id }}" value="Same as" [(ngModel)]="conversionType" inputId="sameAs{{ item.value.id }}"></p-radioButton>
                  <label for="conversionType" class="ml-2"> Same as</label>
                </td>
                <td>
                  <input type="text" pInputText />
                </td>
            </tr>
        </ng-template>
      </p-table>

    </div>
  </p-tabPanel>

  <p-tabPanel header="Term Mapping" [disabled]="!filteredResource">

    <div>
      <p-checkbox label="No lexical senses" [binary]="true" [(ngModel)]="filter.noSenses"></p-checkbox>
      &nbsp;
      <p-checkbox label="Synonyms" [binary]="true" [(ngModel)]="filter.synonyms" [disabled]="filter.noSenses"></p-checkbox>
    </div>

    <p-divider></p-divider>

    <div *ngIf="!filter.noSenses">
      <strong>Polysemic entries</strong>
      <p-table *ngIf="filteredResource?.summary?.polysemic" [value]="filteredResource!.summary.polysemic!" [tableStyle]="{ 'min-width': '50rem' }">
        <ng-template pTemplate="header">
            <tr>
                <th>Term</th>
                <th>Language</th>
                <th>Concept</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-item>
            <tr>
                <td>{{ item.t }}</td>
                <td>{{ item.l }}</td>
                <td>{{ item.c }}</td>
            </tr>
        </ng-template>
      </p-table>

    </div>

  </p-tabPanel>


  <p-tabPanel header="Converted Data" [disabled]="!resource">

    <div class="flex flex-wrap gap-3" *ngIf="resource">
      <strong>Target repository:</strong>
      &nbsp;
      <input type="text" pInputText [(ngModel)]="repository" />
      &nbsp;
      <p-button (click)="onSubmit()" styleClass="p-button-raised p-button-success">Submit</p-button>
      <p-scrollPanel [style]="{width: '1000%', height: '100%'}" *ngIf="resource">
        <pre>{{ resource.sparql }}</pre>
      </p-scrollPanel>
    </div>

    <app-query-view [result]="queryResult"></app-query-view>

  </p-tabPanel>

</p-tabView>
</div>

<div class="layout-footer">
  ILC-CNR &amp; University of Padua
</div>

